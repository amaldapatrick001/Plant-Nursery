{% extends 'partials/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2>Upload Field Image</h2>
    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}
        
        <!-- Image Upload -->
        <div class="form-group mb-3">
            <label for="{{ form.image.id_for_label }}" class="form-label">Field Image</label>
            {{ form.image }}
            {% if form.image.errors %}
            <div class="alert alert-danger mt-2">
                {{ form.image.errors }}
            </div>
            {% endif %}
            <div class="form-text text-muted">Upload an image of your field</div>
        </div>

        <!-- Field Width -->
        <div class="form-group mb-3">
            <label for="{{ form.width.id_for_label }}" class="form-label">Field Width (meters)</label>
            {{ form.width }}
            {% if form.width.errors %}
            <div class="alert alert-danger mt-2">
                {{ form.width.errors }}
            </div>
            {% endif %}
            <div class="form-text text-muted">Enter the width of your field in meters</div>
        </div>

        <!-- Field Length -->
        <div class="form-group mb-3">
            <label for="{{ form.length.id_for_label }}" class="form-label">Field Length (meters)</label>
            {{ form.length }}
            {% if form.length.errors %}
            <div class="alert alert-danger mt-2">
                {{ form.length.errors }}
            </div>
            {% endif %}
            <div class="form-text text-muted">Enter the length of your field in meters</div>
        </div>

        <!-- Form Messages -->
        {% if messages %}
        <div class="messages mb-3">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-upload me-2"></i>Upload Field
        </button>
    </form>
</div>

<!-- Add this JavaScript for form validation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const form = document.querySelector('form');
    
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        
        // Check if file is selected
        const fileInput = document.querySelector('input[type="file"]');
        if (!fileInput.files || fileInput.files.length === 0) {
            event.preventDefault();
            alert('Please select an image file');
            return;
        }
        
        // Check dimensions
        const width = document.querySelector('input[name="width"]').value;
        const length = document.querySelector('input[name="length"]').value;
        
        if (width <= 0 || length <= 0) {
            event.preventDefault();
            alert('Width and length must be greater than 0');
            return;
        }
    });
    
    // File input change handler
    const fileInput = document.querySelector('input[type="file"]');
    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                event.target.value = '';
            }
        }
    });
});
</script>

<!-- Add some basic styling -->
<style>
.form-group {
    margin-bottom: 1rem;
}

.form-label {
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.form-control {
    border-radius: 0.25rem;
}

.btn-primary {
    padding: 0.5rem 1rem;
    font-weight: 500;
}

.alert {
    padding: 0.75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: 0.25rem;
}

.alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.form-text {
    font-size: 0.875rem;
    color: #6c757d;
}
</style>
{% endblock %}
